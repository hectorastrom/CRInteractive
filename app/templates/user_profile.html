{% extends "layout.html" %}

{% block title %}Profile{% endblock %}

{% block main %}
    <div class="content-section">
        <div class="container">
            <div class="row">
                <div class="col-sm-4">
                    <img src="{{ image_file }}" alt="Profile Image" class="rounded-circle account-img">
                </div>
                <div class="col-sm-4">
                    <h2 class="account-heading">{{ user.firstname }} {{ user.lastname }}</h2>
                    <p><strong>Grade: </strong>{% if user.grade %}{{ user.grade }}{% else %}No grade{% endif %}</p>
                    <p><strong>Team: </strong>{% if user.team != "none" %}{{ user.team }}{% else %}No team{% endif %}</p>
                    {% if not user.is_coxswain %}
                    <p><strong>Side: </strong>{% if user.side != "none" %}{{ user.side }}{% else %}No side{% endif %}</p>
                    {% endif %}
                    {% if user.height %}
                    <p><strong>Height: </strong>{{ (user.height / 12) | int }}'{{ user.height % 12 }}"</p>
                    {% endif %}
                    {% if user.weight %}
                    <p><strong>Weight: </strong>{{ user.weight }}lbs</p>
                    {% endif %}
                    </div>
                    {% if not user.is_coxswain %}
                        <div class="col-sm-4">
                            <h2>Scores</h2>
                            <p><strong>2k PR: </strong>{{ twok }}</p>
                            <p><strong>5k PR: </strong>{{ fivek }}</p>
                        </div>
                    {% endif %}
            </div>
        </div>
        <p class="border-bottom border-dark mt-3"></p>
        {% if current_user.id == user.id and not current_user.pinged %}
        <h5>Request for a coach to review your profile</h5>
        <div>
            <form method="POST" action="">
                <div class="form-group col">
                    <button type="submit" class="btn btn-outline-primary rounded-pill">Request Review</button>
                </div>
            </form>
        </div>
        {% else %}
        <h5>Request for a coach to review your profile</h5>
        <div>
            <form method="POST" action="">
                <small class="form-text text-muted ml-4">Request is active.</small>
                <div class="form-group col">
                    <button type="submit" class="btn btn-outline-primary rounded-pill" disabled="true">Request Review</button>
                </div>
            </form>
        </div>
        {% endif %}

        {% if current_user.id != user.id or not all_metrics %}
        <div class="border-bottom border-dark mt-3"></div>
        {% endif %}
        
        <!-- If viewing their own page as a non-coach -->
        {% if current_user.id == user.id and all_metrics %}
        <legend class="border-bottom border-dark mt-3" style="font-weight: 600;">Ratings Shared by Coaches <button id="metric-info" data-toggle="popover" data-placement="top" title="Colors and Sorting" data-content="Metrics are sorted by by descending importance level. Therefore, the metric at the top should be your primary focus. The more blue a metric button is, the more competent you are for that metric.">&#8505;</button></legend>
        <svg width="0" height="0">
            <defs>
                <linearGradient id="CurveGradient1" x1="0" x2=".75" y1="0" y2="0">
                    <stop offset="50%" stop-color="rgba(223,23,34,.5)"/>
                    <stop offset="100%" stop-color="rgba(223,23,200,.5)"/>
                </linearGradient>
                <linearGradient id="CurveGradient2" x1="0" x2=".75" y1="0" y2="0">
                    <stop offset="50%" stop-color="rgba(89,164,235,.5)"/>
                    <stop offset="100%" stop-color="rgba(23,50,189,.5)"/>
                </linearGradient>
            </defs>
        </svg>
        <script>
            let has_update = false
            {% for metric in all_metrics %}
                {% if metric.has_update %}
                    has_update = true
                {% else %}
                    has_update = false
                {% endif %}
                drawUserBellCurve(has_update, "{{ metric.tag }}", "{{ metric.name }}", "{{ metric.desc }}", {{ metric.coach_rating }}, {{ metric.coach_importance }}, {{ metric.user_rating }}, "{{ metric.note }}", "{{ user.firstname }}")
            {% endfor %}
        </script>
        {% endif %}

        <!-- If the user is viewing themselves -->
        {% if current_user.id == user.id %}
            <!-- Add personal charts -->
        {% endif %}
    </div>
{% endblock main %}